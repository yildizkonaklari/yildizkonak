<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>AyvalÄ±k YÄ±ldÄ±z KonaklarÄ± - YÃ¶netim Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="style.css">
    
    <!-- PDF ve Tablo KÃ¼tÃ¼phaneleri -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

    <!-- GÄ°RÄ°Å EKRANI -->
    <div id="login-container" class="login-wrapper">
        <div class="login-box">
            <div class="login-header">
                <h1>YÄ±ldÄ±z KonaklarÄ±</h1>
                <p>Site YÃ¶netim Sistemi</p>
            </div>
            <div class="input-group">
                <input type="text" id="username" placeholder="KullanÄ±cÄ± AdÄ± (Ã–rn: A1)" autocomplete="off">
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="Åifre">
            </div>
            <div class="terms-group">
                <label class="custom-checkbox">
                    <input type="checkbox" id="loginTerms">
                    <span class="checkmark"></span>
                    <span class="label-text"><a href="#" id="openTermsModal">KullanÄ±cÄ± AydÄ±nlatma Metni ve Gizlilik SÃ¶zleÅŸmesini</a> okudum, onaylÄ±yorum.</span>
                </label>
            </div>
            <button id="loginButton" class="btn-login" disabled>GÄ°RÄ°Å YAP</button>
            <div id="loginMessage" class="message hidden"></div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app-layout" class="layout-wrapper hidden">
        
        <!-- YAN MENÃœ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>YÄ±ldÄ±z KonaklarÄ±</h3>
                <p id="sidebar-role-text">YÃ¶netim Paneli</p>
            </div>
            <nav class="sidebar-nav">
                <!-- YÃ¶netici MenÃ¼sÃ¼ -->
                <div id="admin-menu-items" class="hidden">
                    <button class="nav-item active" data-target="view-dashboard">
                        <span class="icon">ğŸ“Š</span> Ã–zet Durum
                    </button>
                    <button class="nav-item" data-target="view-finance">
                        <span class="icon">ğŸ’³</span> Finans & Ä°ÅŸlemler
                    </button>
                    <button class="nav-item" data-target="view-expenses">
                        <span class="icon">ğŸ§¾</span> Gider YÃ¶netimi
                    </button>
                    <button class="nav-item" data-target="view-apartments">
                        <span class="icon">ğŸ¢</span> Daire Listesi
                    </button>
                    <button class="nav-item" data-target="view-settings">
                        <span class="icon">âš™ï¸</span> Ayarlar
                    </button>
                </div>

                <!-- KullanÄ±cÄ± MenÃ¼sÃ¼ -->
                <div id="user-menu-items" class="hidden">
                    <button class="nav-item active" data-target="user-view-debt">
                        <span class="icon">ğŸ’°</span> Bakiyem
                    </button>
                    <button class="nav-item" data-target="user-view-profile">
                        <span class="icon">ğŸ‘¤</span> Profilim
                    </button>
                    <button class="nav-item" id="nav-user-expenses" data-target="user-view-expenses">
                        <span class="icon">ğŸ“‰</span> Site Giderleri
                    </button>
                </div>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="logout-btn">Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
        </aside>

        <!-- ANA Ä°Ã‡ERÄ°K -->
        <main class="main-content">
            <header class="topbar">
                <button id="sidebarToggle" class="sidebar-toggle">â˜°</button>
                <div class="user-info">
                    <span id="display-username">KullanÄ±cÄ±</span>
                    <span id="display-role" class="badge"></span>
                </div>
            </header>

            <!-- YÃ–NETÄ°CÄ°: DASHBOARD -->
            <div id="view-dashboard" class="view-section active">
                <h2 class="page-title">Genel BakÄ±ÅŸ</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card card-blue">
                        <span class="title">Kasa Bakiyesi</span>
                        <span id="dashboardTotalBalance" class="value">...</span>
                    </div>
                    <div class="dashboard-card card-green">
                        <span class="title">Bu Ayki Gelir</span>
                        <span id="dashboardMonthlyIncome" class="value">...</span>
                    </div>
                    <div class="dashboard-card card-red">
                        <span class="title">Bu Ayki Gider</span>
                        <span id="dashboardMonthlyExpense" class="value">...</span>
                    </div>
                    <div class="dashboard-card card-orange">
                        <span class="title">Toplam Alacak</span>
                        <span id="dashboardUnpaidCount" class="value">...</span>
                    </div>
                </div>
                <div style="text-align: right; margin-top:10px;">
                    <button id="refreshDataBtn" class="btn btn-secondary btn-sm">âŸ³ Verileri Yenile</button>
                </div>
            </div>

            <!-- YÃ–NETÄ°CÄ°: FÄ°NANS -->
            <div id="view-finance" class="view-section hidden">
                <h2 class="page-title">Finansal Ä°ÅŸlemler</h2>
                <div class="card">
                    <label>Ä°ÅŸlem YapÄ±lacak Daire:</label>
                    <select id="islemDaireSelect" class="form-control"></select>

                    <div class="tab-container">
                        <button class="tab-button active" id="btnTabBorc">BorÃ§ Ekle</button>
                        <button class="tab-button" id="btnTabTahsilat">Tahsilat Ekle</button>
                        <button class="tab-button" id="btnTabEkstre">Hesap Ekstresi</button>
                    </div>

                    <div id="contentTabBorc" class="tab-content-panel active">
                        <div class="form-row">
                            <div class="col"><select id="borcKime" class="form-control"></select></div>
                            <div class="col"><input type="date" id="borcTarih" class="form-control"></div>
                        </div>
                        <input type="text" id="borcAciklama" class="form-control" placeholder="AÃ§Ä±klama (Ã–rn: Aidat)">
                        <input type="number" id="borcTutar" class="form-control" placeholder="Tutar (â‚º)">
                        <button id="addDebtBtn" class="btn btn-primary full-width">BorÃ§ Ekle</button>
                        <div id="addDebtMessage" class="message hidden"></div>
                    </div>

                    <div id="contentTabTahsilat" class="tab-content-panel">
                        <p class="info-text">(SeÃ§ili daireye iÅŸlenir)</p>
                        <input type="date" id="tahsilatTarih" class="form-control">
                        <input type="number" id="tahsilatTutar" class="form-control" placeholder="Tutar (â‚º)">
                        <input type="text" id="tahsilatAciklama" class="form-control" placeholder="AÃ§Ä±klama">
                        <button id="addTahsilatBtn" class="btn btn-success full-width">Tahsilat Ekle</button>
                        <div id="addTahsilatMessage" class="message hidden"></div>
                    </div>

                    <div id="contentTabEkstre" class="tab-content-panel">
                        <div id="userInfoDisplay" class="user-profile-display hidden"></div>
                        <div class="table-responsive">
                            <table class="transaction-table">
                                <thead><tr><th>Tarih</th><th>AÃ§Ä±klama</th><th>Tutar</th><th>Bakiye</th><th class="admin-only"></th></tr></thead>
                                <tbody id="adminTransactionList"></tbody>
                            </table>
                        </div>
                        <div class="totals" id="bakiyeToplam"></div>
                        <button id="downloadAccountStatementBtn" class="btn btn-secondary full-width mt-2">PDF Ä°ndir</button>
                    </div>
                </div>
            </div>

            <!-- YÃ–NETÄ°CÄ°: GÄ°DERLER -->
            <div id="view-expenses" class="view-section hidden">
                <h2 class="page-title">Gider YÃ¶netimi</h2>
                <div class="card admin-only">
                    <h4>Yeni Gider</h4>
                    <div class="form-row">
                        <input type="date" id="expenseDateInput" class="form-control">
                        <input type="text" id="expenseNameInput" class="form-control" placeholder="Harcama AdÄ±">
                        <input type="number" id="expenseAmountInput" class="form-control" placeholder="Tutar">
                    </div>
                    <button id="saveExpenseBtn" class="btn btn-primary full-width mt-2">Kaydet</button>
                    <div id="expenseMessage" class="message hidden"></div>
                </div>

                <div class="month-selector">
                    <button id="expensePrevMonthBtn">â—€</button>
                    <span id="expenseCurrentMonthDisplay"></span>
                    <button id="expenseNextMonthBtn">â–¶</button>
                </div>
                
                <div class="action-buttons mt-2">
                    <button id="publishButton" class="btn btn-warning admin-only">Giderleri YayÄ±nla</button>
                    <button id="downloadMonthlyExpensesBtn" class="btn btn-success">Rapor Ä°ndir (PDF)</button>
                </div>

                <div id="adminExpenseListContainer" class="expense-list mt-3"></div>
                <div class="totals" id="adminExpenseTotals"></div>
            </div>

            <!-- YÃ–NETÄ°CÄ°: DAÄ°RELER -->
            <div id="view-apartments" class="view-section hidden">
                <h2 class="page-title">Daireler</h2>
                <input type="search" id="apartmentSearchInput" class="form-control" placeholder="Daire ara...">
                <div id="apartmentListContainer" class="apartment-list mt-3"></div>
            </div>

            <!-- YÃ–NETÄ°CÄ°: AYARLAR -->
            <div id="view-settings" class="view-section hidden">
                <h2 class="page-title">Ayarlar</h2>
                <div class="card">
                    <h4>Åifre DeÄŸiÅŸtir</h4>
                    <div class="form-row">
                        <select id="sifreDaire" class="form-control"></select>
                        <input type="password" id="yeniSifre" class="form-control" placeholder="Yeni Åifre">
                    </div>
                    <button id="savePasswordBtn" class="btn btn-primary full-width mt-2">Kaydet</button>
                    <hr>
                    <input type="password" id="adminYeniSifre" class="form-control mt-3" placeholder="Yeni Admin Åifresi">
                    <button id="saveAdminPasswordBtn" class="btn btn-danger full-width mt-2">Admin Åifresini GÃ¼ncelle</button>
                    <div id="passwordMessage" class="message hidden"></div>
                </div>
            </div>

            <!-- KULLANICI: BAKÄ°YE (Akordeon YapÄ±sÄ±) -->
            <div id="user-view-debt" class="view-section hidden">
                <h2 class="page-title">Hesap Durumu</h2>
                <!-- TÄ±klanabilir Ã–zet KartÄ± -->
                <div id="userBalanceCard" class="balance-summary-card collapsible-trigger">
                    <div class="balance-content">
                        <span class="summary-title">GÃ¼ncel Bakiye</span>
                        <span id="userUnpaidTotal" class="summary-amount">...</span>
                    </div>
                    <span class="toggle-icon">â–¼</span>
                </div>
                
                <!-- Gizlenip/AÃ§Ä±lan Detay AlanÄ± -->
                <div id="userBalanceDetails" class="card mt-3 collapsed-content">
                    <h4 style="border-bottom: 1px solid #eee; padding-bottom:10px; margin-top:0;">Hesap Hareketleri</h4>
                    <div class="table-responsive">
                        <table class="transaction-table mobile-responsive-table">
                            <thead><tr><th>Tarih</th><th>AÃ§Ä±klama</th><th>Tutar</th><th>Bakiye</th></tr></thead>
                            <tbody id="userTransactionList"></tbody>
                        </table>
                    </div>
                    <div class="totals" id="userDebtTotals"></div>
                </div>
                
                <div class="bank-info mt-3">
                    <p><strong>YÄ±ldÄ±z KonaklarÄ± Site YÃ¶netimi</strong></p>
                    <p><strong>IBAN:</strong> TR510001000110981102095001</p>
                </div>
            </div>

            <!-- KULLANICI: PROFÄ°L -->
            <div id="user-view-profile" class="view-section hidden">
                <h2 class="page-title">Profilim</h2>
                <div class="card">
                    <div id="profileDisplayView" class="user-profile-display"></div>
                    <button id="changePasswordBtn" class="btn btn-secondary full-width mt-3">Åifre DeÄŸiÅŸtir</button>
                    <div id="profileMessage" class="message hidden"></div>
                </div>
            </div>

            <!-- KULLANICI: GÄ°DERLER -->
            <div id="user-view-expenses" class="view-section hidden">
                <h2 class="page-title">Site Giderleri</h2>
                <div id="expenseNotPublishedMessage" class="message hidden">YayÄ±nlanmÄ±ÅŸ gider bulunmamaktadÄ±r.</div>
                <div id="expenseTableContainer">
                    <div id="userExpenseList" class="expense-list"></div>
                    <div class="totals" id="userExpenseTotals"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- MODALS -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h4>KullanÄ±cÄ± AydÄ±nlatma Metni ve Gizlilik SÃ¶zleÅŸmesi</h4>
            <div class="terms-box" style="height: 300px; overflow-y: scroll; border:1px solid #eee; padding:10px;">
                <p>6698 sayÄ±lÄ± KiÅŸisel Verilerin KorunmasÄ± Kanunu (â€œKVKKâ€) uyarÄ±nca, kiÅŸisel verileriniz; veri sorumlusu olarak YÄ±ldÄ±z KonaklarÄ± Site YÃ¶netimi tarafÄ±ndan aÅŸaÄŸÄ±da aÃ§Ä±klanan kapsamda iÅŸlenebilecektir.</p>
                <p>Toplanan kiÅŸisel verileriniz, site sakinlerimize sunulan hizmetlerin iyileÅŸtirilmesi, aidat ve gider takibinin yapÄ±lmasÄ±, site iÃ§i iletiÅŸimin saÄŸlanmasÄ± ve yasal yÃ¼kÃ¼mlÃ¼lÃ¼klerin yerine getirilmesi amaÃ§larÄ±yla KVKKâ€™nÄ±n 5. ve 6. maddelerinde belirtilen kiÅŸisel veri iÅŸleme ÅŸartlarÄ± ve amaÃ§larÄ± dahilinde iÅŸlenecektir.</p>
                <p>Ä°ÅŸlenen kiÅŸisel verileriniz; yukarÄ±da sayÄ±lan amaÃ§larÄ±n gerÃ§ekleÅŸtirilmesi doÄŸrurultusunda, yetkili kamu kurum ve kuruluÅŸlarÄ±na, hukuki uyuÅŸmazlÄ±klarÄ±n giderilmesi iÃ§in avukatlara veya adli makamlara aktarÄ±labilecektir.</p>
                <p>KiÅŸisel veri sahibi olarak KVKKâ€™nÄ±n 11. maddesi uyarÄ±nca sahip olduÄŸunuz haklarÄ± kullanmak iÃ§in bizimle iletiÅŸime geÃ§ebilirsiniz.</p>
                <p><strong>Gizlilik SÃ¶zleÅŸmesi:</strong> Bu platforma kaydolarak, paylaÅŸtÄ±ÄŸÄ±nÄ±z kiÅŸisel verilerin (Ad, Soyad, Telefon, E-posta) yalnÄ±zca site yÃ¶netimi hizmetleri kapsamÄ±nda kullanÄ±lacaÄŸÄ±nÄ±, Ã¼Ã§Ã¼ncÃ¼ kiÅŸilerle paylaÅŸÄ±lmayacaÄŸÄ±nÄ± kabul etmiÅŸ olursunuz.</p>
            </div>
        </div>
    </div>

    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <h4>KayÄ±t Tamamla</h4>
            <p>HoÅŸgeldiniz <strong id="welcomeUserName"></strong>, lÃ¼tfen bilgilerinizi tamamlayÄ±nÄ±z.</p>
            <input type="tel" id="regTelefon" class="form-control mt-2" placeholder="Telefon">
            <input type="email" id="regMail" class="form-control mt-2" placeholder="E-posta">
            <input type="text" id="regAdres" class="form-control mt-2" placeholder="Adres">
            <button id="saveRegistrationBtn" class="btn btn-primary full-width mt-3">Kaydet</button>
            <div id="registrationMessage" class="message hidden"></div>
        </div>
    </div>

    <div id="apartmentDetailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h3 id="apartmentDetailTitle">Detay</h3>
            <div id="apartmentDetailContent"></div>
            <div class="modal-actions mt-3">
                <button id="editApartmentDetailBtn" class="btn btn-warning">DÃ¼zenle</button>
                <button id="downloadApartmentStatementBtn" class="btn btn-secondary">Ekstre</button>
                <button id="deleteApartmentBtn" class="btn btn-danger">Sil</button>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
