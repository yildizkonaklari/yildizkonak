<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ayvalƒ±k Yƒ±ldƒ±z Konaklarƒ± - Y√∂netim Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <!-- Stil Dosyasƒ± Baƒülantƒ±sƒ± -->
    <link rel="stylesheet" href="style.css">
    
    <!-- K√ºt√ºphaneler -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- Gƒ∞Rƒ∞≈û EKRANI (Login) -->
    <div id="login-container" class="login-wrapper">
        <div class="login-box">
            <h1 class="login-title">Yƒ±ldƒ±z Konaklarƒ±</h1>
            <h2 class="login-subtitle">Aidat Takip Sistemi</h2>
            <div class="input-group">
                <input type="text" id="username" placeholder="Kullanƒ±cƒ± Adƒ± (√∂rn: A1)">
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="≈ûifre">
            </div>
            <label class="terms-label">
                <input type="checkbox" id="loginTerms">
                <span><a href="#" id="openTermsModal">Aydƒ±nlatma Metni ve Gizlilik S√∂zle≈ümesini</a> okudum.</span>
            </label>
            <button id="loginButton" disabled>Giri≈ü Yap</button>
            <div id="loginMessage" class="message hidden"></div>
        </div>
    </div>

    <!-- ANA UYGULAMA (Giri≈ü Ba≈üarƒ±lƒ±ysa G√∂r√ºn√ºr) -->
    <div id="app-layout" class="layout-wrapper hidden">
        
        <!-- YAN MEN√ú (Sidebar) -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>Yƒ±ldƒ±z Konaklarƒ±</h3>
                <p>Y√∂netim Paneli</p>
            </div>
            <nav class="sidebar-nav">
                <!-- Y√∂netici Men√ºs√º -->
                <div id="admin-menu-items" class="hidden">
                    <button class="nav-item active" data-target="view-dashboard">
                        <span class="icon">üìä</span> √ñzet Durum
                    </button>
                    <button class="nav-item" data-target="view-finance">
                        <span class="icon">üí≥</span> Finans & ƒ∞≈ülemler
                    </button>
                    <button class="nav-item" data-target="view-expenses">
                        <span class="icon">üßæ</span> Gider Y√∂netimi
                    </button>
                    <button class="nav-item" data-target="view-apartments">
                        <span class="icon">üè¢</span> Daire Listesi
                    </button>
                    <button class="nav-item" data-target="view-settings">
                        <span class="icon">‚öôÔ∏è</span> Ayarlar & ≈ûifre
                    </button>
                </div>

                <!-- Kullanƒ±cƒ± Men√ºs√º -->
                <div id="user-menu-items" class="hidden">
                    <button class="nav-item active" data-target="user-view-debt">
                        <span class="icon">üí∞</span> Bakiyem
                    </button>
                    <button class="nav-item" data-target="user-view-profile">
                        <span class="icon">üë§</span> Profilim
                    </button>
                    <button class="nav-item" id="nav-user-expenses" data-target="user-view-expenses">
                        <span class="icon">üìâ</span> Site Giderleri
                    </button>
                </div>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="logout-btn">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </aside>

        <!-- ANA ƒ∞√áERƒ∞K ALANI -->
        <main class="main-content">
            <!-- √úst Bilgi √áubuƒüu (Mobile Toggle + User Info) -->
            <header class="topbar">
                <button id="sidebarToggle" class="sidebar-toggle">‚ò∞</button>
                <div class="user-info">
                    <span id="display-username">Kullanƒ±cƒ±</span>
                    <span id="display-role" class="badge"></span>
                </div>
            </header>

            <!-- ================= Y√ñNETƒ∞Cƒ∞ SAYFALARI ================= -->
            
            <!-- 1. DASHBOARD (√ñzet) -->
            <div id="view-dashboard" class="view-section active">
                <h2 class="page-title">Genel Bakƒ±≈ü</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card card-blue">
                        <span class="title">Kasa Bakiyesi</span>
                        <span id="dashboardTotalBalance" class="value">...</span>
                    </div>
                    <div class="dashboard-card card-green">
                        <span class="title">Bu Ayki Gelir</span>
                        <span id="dashboardMonthlyIncome" class="value">...</span>
                    </div>
                    <div class="dashboard-card card-red">
                        <span class="title">Bu Ayki Gider</span>
                        <span id="dashboardMonthlyExpense" class="value">...</span>
                    </div>
                    <div class="dashboard-card card-orange">
                        <span class="title">Toplam Alacak</span>
                        <span id="dashboardUnpaidCount" class="value">...</span>
                    </div>
                </div>
                <!-- Ekstra: Bakiye Yenile Butonu Buraya Eklenebilir -->
                <div style="text-align: right; margin-top: 10px;">
                    <button id="refreshDataBtn" class="btn-sm btn-info">Verileri Yenile</button>
                </div>
            </div>

            <!-- 2. Fƒ∞NANS & ƒ∞≈ûLEMLER (Sekmeli Yapƒ±) -->
            <div id="view-finance" class="view-section hidden">
                <h2 class="page-title">Finansal ƒ∞≈ülemler</h2>
                
                <div class="card">
                    <div style="padding-bottom: 15px;">
                        <label for="islemDaireSelect" style="font-weight:bold;">ƒ∞≈ülem Yapƒ±lacak Daire:</label>
                        <select id="islemDaireSelect" class="form-control"></select>
                    </div>

                    <!-- Sekme Ba≈ülƒ±klarƒ± -->
                    <div class="tab-container">
                        <button class="tab-button active" id="btnTabBorc">Bor√ß Ekle</button>
                        <button class="tab-button" id="btnTabTahsilat">Tahsilat Ekle</button>
                        <button class="tab-button" id="btnTabEkstre">Hesap Ekstresi</button>
                    </div>

                    <!-- Sekme ƒ∞√ßerikleri -->
                    <!-- Bor√ß Ekle -->
                    <div id="contentTabBorc" class="tab-content-panel active">
                        <div class="form-row">
                            <div class="col">
                                <label>Kime:</label>
                                <select id="borcKime" class="form-control"></select>
                            </div>
                            <div class="col">
                                <label>Tarih:</label>
                                <input type="date" id="borcTarih" class="form-control">
                            </div>
                        </div>
                        <input type="text" id="borcAciklama" class="form-control" placeholder="A√ßƒ±klama (√∂rn: Kasƒ±m Aidatƒ±)">
                        <input type="number" id="borcTutar" class="form-control" placeholder="Tutar (‚Ç∫)">
                        <button id="addDebtBtn" class="btn btn-primary mt-2">Bor√ß Ekle</button>
                        <div id="addDebtMessage" class="message hidden"></div>
                    </div>

                    <!-- Tahsilat Ekle -->
                    <div id="contentTabTahsilat" class="tab-content-panel">
                        <p class="info-text">(Yukarƒ±dan se√ßilen daireye i≈ülenir)</p>
                        <input type="date" id="tahsilatTarih" class="form-control">
                        <input type="number" id="tahsilatTutar" class="form-control" placeholder="Tahsilat Tutarƒ± (‚Ç∫)">
                        <input type="text" id="tahsilatAciklama" class="form-control" placeholder="A√ßƒ±klama (√∂rn: Havale)">
                        <button id="addTahsilatBtn" class="btn btn-success mt-2">Tahsilat Ekle</button>
                        <div id="addTahsilatMessage" class="message hidden"></div>
                    </div>

                    <!-- Ekstre -->
                    <div id="contentTabEkstre" class="tab-content-panel">
                        <div id="userInfoDisplay" class="user-profile-display hidden"></div>
                        <div class="table-responsive">
                            <table class="transaction-table">
                                <thead>
                                    <tr>
                                        <th>Tarih</th>
                                        <th>A√ßƒ±klama</th>
                                        <th>Tutar</th>
                                        <th>Bakiye</th>
                                        <th class="admin-only">ƒ∞≈ülem</th>
                                    </tr>
                                </thead>
                                <tbody id="adminTransactionList"></tbody>
                            </table>
                        </div>
                        <div class="totals" id="bakiyeToplam"></div>
                        <div class="action-buttons mt-2">
                            <button id="downloadAccountStatementBtn" class="btn btn-secondary">PDF ƒ∞ndir</button>
                        </div>
                        <div id="adminTableMessage" class="message hidden"></div>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <h4>Toplu ƒ∞≈ülemler</h4>
                    <div class="flex-wrap-gap">
                        <button id="downloadTemplateBtn" class="btn btn-outline">≈ûablon ƒ∞ndir</button>
                        <input type="file" id="profileTemplateInput" accept=".csv" style="display: none;">
                        <button id="uploadTemplateBtn" class="btn btn-outline">≈ûablon Y√ºkle</button>
                        <button id="downloadAllProfilesCsvBtn" class="btn btn-secondary">T√ºm Profiller (Excel)</button>
                        <button id="deleteAllTransactionsBtn" class="btn btn-danger">T√ºm Verileri Sƒ±fƒ±rla</button>
                    </div>
                </div>
            </div>

            <!-- 3. Gƒ∞DERLER -->
            <div id="view-expenses" class="view-section hidden">
                <h2 class="page-title">Gider Y√∂netimi</h2>
                <div class="card admin-only">
                    <h4>Yeni Gider Ekle</h4>
                    <div class="form-row">
                        <input type="date" id="expenseDateInput" class="form-control">
                        <input type="text" id="expenseNameInput" class="form-control" placeholder="Harcama Adƒ±">
                        <input type="number" id="expenseAmountInput" class="form-control" placeholder="Tutar (‚Ç∫)">
                    </div>
                    <button id="saveExpenseBtn" class="btn btn-primary mt-2">Kaydet</button>
                    <div id="expenseMessage" class="message hidden"></div>
                </div>

                <div class="month-selector mt-3">
                    <button id="expensePrevMonthBtn">&lt;</button>
                    <span id="expenseCurrentMonthDisplay">Kasƒ±m 2025</span>
                    <button id="expenseNextMonthBtn">&gt;</button>
                </div>
                
                <div class="action-buttons mt-2">
                    <button id="publishButton" class="btn btn-warning admin-only">Giderleri Yayƒ±nla</button>
                    <button id="downloadMonthlyExpensesBtn" class="btn btn-success">Rapor ƒ∞ndir (PDF)</button>
                </div>

                <div id="adminExpenseListContainer" class="expense-list mt-3"></div>
                <div class="totals" id="adminExpenseTotals"></div>
            </div>

            <!-- 4. DAƒ∞RELER -->
            <div id="view-apartments" class="view-section hidden">
                <h2 class="page-title">Daire Listesi</h2>
                <input type="search" id="apartmentSearchInput" class="form-control" placeholder="Daire no veya isim ile ara...">
                <div id="apartmentListContainer" class="apartment-list mt-3"></div>
            </div>

            <!-- 5. AYARLAR -->
            <div id="view-settings" class="view-section hidden">
                <h2 class="page-title">Ayarlar</h2>
                <div class="card">
                    <h4>≈ûifre ƒ∞≈ülemleri</h4>
                    <label>Daire ≈ûifresi Deƒüi≈ütir:</label>
                    <div class="form-row">
                        <select id="sifreDaire" class="form-control"></select>
                        <input type="password" id="yeniSifre" class="form-control" placeholder="Yeni ≈ûifre">
                    </div>
                    <button id="savePasswordBtn" class="btn btn-primary mt-2">Daire ≈ûifresini Kaydet</button>
                    
                    <hr>
                    <label>Y√∂netici ≈ûifresi:</label>
                    <input type="password" id="adminYeniSifre" class="form-control mb-2" placeholder="Yeni Admin ≈ûifresi">
                    <button id="saveAdminPasswordBtn" class="btn btn-danger">Admin ≈ûifresini G√ºncelle</button>

                    <hr>
                    <label>G√∂r√ºnt√ºleme (Y√∂netim) ≈ûifresi:</label>
                    <input type="password" id="viewerAdminYeniSifre" class="form-control mb-2" placeholder="Yeni G√∂r√ºnt√ºleme ≈ûifresi">
                    <button id="saveViewerAdminPasswordBtn" class="btn btn-warning">G√∂r√ºnt√ºleme ≈ûifresini G√ºncelle</button>
                    
                    <div id="passwordMessage" class="message hidden"></div>
                </div>
            </div>

            <!-- ================= KULLANICI SAYFALARI ================= -->
            
            <div id="user-view-debt" class="view-section hidden">
                <h2 class="page-title">Hesap Durumu</h2>
                <div id="profileIncompleteMessage" class="error-box hidden"></div>
                
                <div class="balance-summary-card">
                    <div>
                        <span class="summary-title">G√ºncel Bakiye</span>
                        <span id="userUnpaidTotal" class="summary-amount">...</span>
                    </div>
                </div>

                <div class="card mt-3">
                    <h4>Hesap Hareketleri</h4>
                    <div class="table-responsive">
                        <table class="transaction-table">
                            <thead>
                                <tr><th>Tarih</th><th>A√ßƒ±klama</th><th>Tutar</th><th>Bakiye</th></tr>
                            </thead>
                            <tbody id="userTransactionList"></tbody>
                        </table>
                    </div>
                    <div class="totals" id="userDebtTotals"></div>
                </div>
                
                <div class="bank-info mt-3">
                    <p><strong>Yƒ±ldƒ±z Konaklarƒ± Site Y√∂netimi</strong></p>
                    <p><strong>IBAN:</strong> TR510001000110981102095001</p>
                </div>
            </div>

            <div id="user-view-profile" class="view-section hidden">
                <h2 class="page-title">Profilim</h2>
                <div class="card">
                    <div id="profileDisplayView"></div>
                    <button id="changePasswordBtn" class="btn btn-secondary mt-2">≈ûifre Deƒüi≈ütir</button>
                    <div id="profileMessage" class="message hidden"></div>
                </div>
            </div>

            <div id="user-view-expenses" class="view-section hidden">
                <h2 class="page-title">Site Giderleri</h2>
                <div id="expenseNotPublishedMessage" class="message hidden"></div>
                <div id="expenseTableContainer">
                    <div id="userExpenseList" class="expense-list"></div>
                    <div class="totals" id="userExpenseTotals"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- MODALS -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span id="modalCloseBtn" class="modal-close">&times;</span>
            <h4>S√∂zle≈üme</h4>
            <div class="terms-box">
                <p>KVKK ve Gizlilik metni buradadƒ±r...</p>
            </div>
        </div>
    </div>

    <div id="registrationModal" class="modal">
        <div class="modal-content">
            <h4>Kayƒ±t Tamamla</h4>
            <p>Ho≈ügeldiniz <strong id="welcomeUserName"></strong>, l√ºtfen bilgilerinizi tamamlayƒ±nƒ±z.</p>
            <input type="tel" id="regTelefon" class="form-control mb-2" placeholder="Telefon">
            <input type="tel" id="regTelefon2" class="form-control mb-2" placeholder="Telefon 2 (Opsiyonel)">
            <input type="email" id="regMail" class="form-control mb-2" placeholder="E-posta">
            <input type="text" id="regAdres" class="form-control mb-2" placeholder="Adres">
            <button id="saveRegistrationBtn" class="btn btn-primary">Kaydet</button>
            <div id="registrationMessage" class="message hidden"></div>
        </div>
    </div>

    <div id="apartmentDetailModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="document.getElementById('apartmentDetailModal').style.display='none'">&times;</span>
            <h3 id="apartmentDetailTitle">Detaylar</h3>
            <div id="apartmentDetailContent"></div>
            <div class="modal-actions mt-3">
                <button id="editApartmentDetailBtn" class="btn btn-warning">D√ºzenle</button>
                <button id="downloadApartmentStatementBtn" class="btn btn-secondary">Ekstre (PDF)</button>
                <button id="deleteApartmentBtn" class="btn btn-danger">Sil</button>
            </div>
        </div>
    </div>

    <!-- Uygulama Mantƒ±ƒüƒ± -->
    <!-- Type module √∂nemlidir -->
    <script type="module" src="app.js"></script>
</body>
</html>
