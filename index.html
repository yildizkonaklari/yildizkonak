<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>AyvalÄ±k YÄ±ldÄ±z KonaklarÄ± - YÃ¶netim Paneli</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <link rel="stylesheet" href="style.css">
    
    <!-- PDF ve Tablo KÃ¼tÃ¼phaneleri -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>
</head>
<body>

    <!-- MOBÄ°L ÃœST BANNER (Sadece Mobilde GÃ¶rÃ¼nÃ¼r) -->
    <div class="mobile-site-banner">YÄ±ldÄ±z KonaklarÄ± Sitesi</div>

    <!-- GÄ°RÄ°Å EKRANI -->
    <div id="login-container" class="login-wrapper">
        <div class="login-box">
            <div class="login-header">
                <h1>YÄ±ldÄ±z KonaklarÄ±</h1>
                <p>Site YÃ¶netim Sistemi</p>
            </div>
            <div class="input-group">
                <input type="text" id="username" placeholder="KullanÄ±cÄ± AdÄ± (Ã–rn: A1)" autocomplete="off">
            </div>
            <div class="input-group">
                <input type="password" id="password" placeholder="Åifre">
            </div>
            <div class="terms-group">
                <label class="custom-checkbox">
                    <input type="checkbox" id="loginTerms">
                    <span class="checkmark"></span>
                    <span class="label-text"><a href="#" id="openTermsModal">KullanÄ±cÄ± AydÄ±nlatma Metni ve Gizlilik SÃ¶zleÅŸmesini</a> okudum, onaylÄ±yorum.</span>
                </label>
            </div>
            <button id="loginButton" class="btn-login" disabled>GÄ°RÄ°Å YAP</button>
            <div id="loginMessage" class="message hidden"></div>
        </div>
    </div>

    <!-- ANA UYGULAMA -->
    <div id="app-layout" class="layout-wrapper hidden">
        
        <!-- Sidebar Overlay (Mobil iÃ§in) -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <!-- YAN MENÃœ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>YÄ±ldÄ±z KonaklarÄ±</h3>
                <p id="sidebar-role-text">YÃ¶netim Paneli</p>
            </div>
            <nav class="sidebar-nav">
                <div id="admin-menu-items" class="hidden">
                    <button class="nav-item active" data-target="view-dashboard"><span class="icon">ğŸ“Š</span> Ã–zet Durum</button>
                    <button class="nav-item" id="nav-finance" data-target="view-finance"><span class="icon">ğŸ’³</span> Finans & Ä°ÅŸlemler</button>
                    <button class="nav-item" data-target="view-expenses"><span class="icon">ğŸ§¾</span> Gider YÃ¶netimi</button>
                    <button class="nav-item" data-target="view-apartments"><span class="icon">ğŸ¢</span> Daire Listesi</button>
                    <button class="nav-item" data-target="view-reports"><span class="icon">ğŸ“ˆ</span> Raporlar</button>

                    <button class="nav-item" id="nav-settings" data-target="view-settings"><span class="icon">âš™ï¸</span> Ayarlar</button>
                </div>
                <div id="user-menu-items" class="hidden">
                    <button class="nav-item active" data-target="user-view-debt"><span class="icon">ğŸ’°</span> Bakiyem</button>
                    <button class="nav-item" data-target="user-view-profile"><span class="icon">ğŸ‘¤</span> Profilim</button>
                    <button class="nav-item" id="nav-user-expenses" data-target="user-view-expenses"><span class="icon">ğŸ“‰</span> Site Giderleri</button>
                </div>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="logout-btn">Ã‡Ä±kÄ±ÅŸ Yap</button>
            </div>
        </aside>

        <!-- ANA Ä°Ã‡ERÄ°K -->
        <main class="main-content">
            <header class="topbar">
                <div style="display:flex; align-items:center;">
                    <button id="sidebarToggle" class="sidebar-toggle">â˜°</button>
                    <!-- MasaÃ¼stÃ¼ BaÅŸlÄ±k (Mobilde gizli) -->
                    <h4 class="desktop-header-title" style="margin:0; margin-left:15px; color:var(--primary);">YÃ¶netim Paneli</h4>
                </div>
                <div class="user-info">
                    <span id="display-username">KullanÄ±cÄ±</span>
                    <span id="display-role" class="badge"></span>
                </div>
            </header>

            <!-- YÃ–NETÄ°CÄ°: DASHBOARD -->
            <div id="view-dashboard" class="view-section active">
                <h2 class="page-title">Genel BakÄ±ÅŸ</h2>
                <div class="dashboard-grid">
                    <div class="dashboard-card card-blue"><span class="title">Kasa Bakiyesi</span><span id="dashboardTotalBalance" class="value">...</span></div>
                    <div class="dashboard-card card-green"><span class="title">Bu Ayki Gelir</span><span id="dashboardMonthlyIncome" class="value">...</span></div>
                    <div class="dashboard-card card-red"><span class="title">Bu Ayki Gider</span><span id="dashboardMonthlyExpense" class="value">...</span></div>
                    <div class="dashboard-card card-orange"><span class="title">Toplam Alacak</span><span id="dashboardUnpaidCount" class="value">...</span></div>
                </div>
                
                <!-- SON Ä°ÅLEMLER -->
                <div class="recent-transactions-container">
                    <h3 style="margin-top:0; margin-bottom:15px; color:var(--primary); font-size:1.2em;">Son Ä°ÅŸlemler</h3>
                    <div class="table-responsive">
                        <table class="recent-transactions-table">
                            <thead><tr><th>Daire</th><th>Ä°ÅŸlem TÃ¼rÃ¼</th><th>AÃ§Ä±klama</th><th>Tarih</th><th style="text-align:right">Tutar</th></tr></thead>
                            <tbody id="dashboardRecentTransactions"><tr><td colspan="5" style="text-align:center; color:#999;">YÃ¼kleniyor...</td></tr></tbody>
                        </table>
                    </div>
                </div>
                <div style="text-align: right; margin-top:10px;"><button id="refreshDataBtn" class="btn btn-secondary btn-sm">âŸ³ Verileri Yenile</button></div>
            </div>
<!-- 2. YENÄ° RAPORLAR SAYFASI -->
            <div id="view-reports" class="view-section hidden">
                <h2 class="page-title">DetaylÄ± Finansal Raporlar</h2>
                
                <!-- Filtreleme AlanÄ± -->
                <div class="card filter-card">
                    <h4 style="margin-top:0; font-size:1em; color:#666;">Filtreleme SeÃ§enekleri</h4>
                    <div class="filter-row">
                        <div class="filter-item">
                            <label>BaÅŸlangÄ±Ã§ Tarihi:</label>
                            <input type="date" id="reportStartDate" class="form-control">
                        </div>
                        <div class="filter-item">
                            <label>BitiÅŸ Tarihi:</label>
                            <input type="date" id="reportEndDate" class="form-control">
                        </div>
                        <div class="filter-item">
                            <label>Ä°ÅŸlem TÃ¼rÃ¼:</label>
                            <select id="reportTypeFilter" class="form-control">
                                <option value="all">TÃ¼mÃ¼ (Gelir/Gider/BorÃ§)</option>
                                <option value="income">Sadece Tahsilatlar</option>
                                <option value="expense">Sadece Giderler</option>
                                <option value="debt">Sadece BorÃ§ TahakkuklarÄ±</option>
                                <option value="debtors">BorÃ§lu Listesi (GÃ¼ncel Bakiye)</option>
                            </select>
                        </div>
                        <div class="filter-item">
                            <label>Daire:</label>
                            <select id="reportFlatFilter" class="form-control">
                                <!-- JS ile dolacak -->
                            </select>
                        </div>
                    </div>
                    <div class="filter-actions">
                        <button id="applyReportFilterBtn" class="btn btn-primary">Raporu Getir</button>
                        <button id="downloadReportPdfBtn" class="btn btn-secondary">PDF Olarak Ä°ndir</button>
                    </div>
                </div>

                <!-- Rapor SonuÃ§ Tablosu -->
                <div class="card">
                    <div class="report-summary-bar">
                        <span>Toplam Gelir: <strong id="repTotalInc" class="text-success">0 â‚º</strong></span>
                        <span>Toplam Gider: <strong id="repTotalExp" class="text-danger">0 â‚º</strong></span>
                        <span>Net Bakiye: <strong id="repNetBal" class="text-primary">0 â‚º</strong></span>
                    </div>
                    <div class="table-responsive">
                        <table class="transaction-table mobile-responsive-table" id="reportTable">
                            <thead>
                                <tr>
                                    <th>Tarih</th>
                                    <th>TÃ¼r</th>
                                    <th>Ä°lgili KiÅŸi/Yer</th>
                                    <th>AÃ§Ä±klama</th>
                                    <th>Tutar</th>
                                </tr>
                            </thead>
                            <tbody id="reportTableBody">
                                <tr><td colspan="5" style="text-align:center;">Filtreleri seÃ§ip 'Raporu Getir' butonuna basÄ±nÄ±z.</td></tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Sayfalama (Pagination) -->
                    <div class="pagination-container">
                        <button id="prevPageBtn" class="btn btn-sm btn-outline" disabled>Â« Ã–nceki</button>
                        <span id="pageIndicator">Sayfa 1 / 1</span>
                        <button id="nextPageBtn" class="btn btn-sm btn-outline" disabled>Sonraki Â»</button>
                    </div>
                </div>
            </div>
            <!-- YÃ–NETÄ°CÄ°: FÄ°NANS -->
            <div id="view-finance" class="view-section hidden">
                <h2 class="page-title">Finansal Ä°ÅŸlemler</h2>
                <div class="card">
                    <label>Ä°ÅŸlem YapÄ±lacak Daire:</label>
                    <select id="islemDaireSelect" class="form-control mb-3"></select>

                    <div class="tab-container">
                        <button class="tab-button active" id="btnTabBorc">BorÃ§ Ekle</button>
                        <button class="tab-button" id="btnTabTahsilat">Tahsilat Ekle</button>
                        <button class="tab-button" id="btnTabEkstre">Hesap Ekstresi</button>
                    </div>

                    <div id="contentTabBorc" class="tab-content-panel active">
                        <div class="form-row"><div class="col"><label>Kime:</label><select id="borcKime" class="form-control"></select></div><div class="col"><label>Tarih:</label><input type="date" id="borcTarih" class="form-control"></div></div>
                        <input type="text" id="borcAciklama" class="form-control mb-2" placeholder="AÃ§Ä±klama">
                        <input type="number" id="borcTutar" class="form-control mb-3" placeholder="Tutar">
                        <button id="addDebtBtn" class="btn btn-primary full-width">BorÃ§ Ekle</button>
                        <div id="addDebtMessage" class="message hidden"></div>
                        <div style="margin-top: 25px; padding-top: 15px; border-top: 1px solid #eee;">
                            <h5 style="margin-bottom: 10px; color: #555;">Toplu Ä°ÅŸlemler</h5>
                            <button id="addLateFeeBtn" class="btn btn-warning full-width">Bu Ay Ä°Ã§in %5 Gecikme TazminatÄ± Uygula</button>
                        </div>
                    </div>

                    <div id="contentTabTahsilat" class="tab-content-panel">
                        <p class="info-text">(YukarÄ±da seÃ§ilen daireye iÅŸlenir)</p>
                        <input type="date" id="tahsilatTarih" class="form-control mb-2">
                        <input type="number" id="tahsilatTutar" class="form-control mb-2" placeholder="Tutar">
                        <input type="text" id="tahsilatAciklama" class="form-control mb-3" placeholder="AÃ§Ä±klama">
                        <button id="addTahsilatBtn" class="btn btn-success full-width">Tahsilat Ekle</button>
                        <div id="addTahsilatMessage" class="message hidden"></div>
                    </div>

                    <div id="contentTabEkstre" class="tab-content-panel">
                        <div id="userInfoDisplay" class="user-profile-display hidden"></div>
                        <div class="table-responsive"><table class="transaction-table mobile-responsive-table"><thead><tr><th>Tarih</th><th>AÃ§Ä±klama</th><th>Tutar</th><th>Bakiye</th><th class="admin-only"></th></tr></thead><tbody id="adminTransactionList"></tbody></table></div>
                        <div class="totals" id="bakiyeToplam"></div>
                        <button id="downloadAccountStatementBtn" class="btn btn-secondary full-width mt-2">PDF Ä°ndir</button>
                    </div>
                </div>
            </div>

            <!-- YÃ–NETÄ°CÄ°: GÄ°DERLER -->
            <div id="view-expenses" class="view-section hidden">
                <h2 class="page-title">Gider YÃ¶netimi</h2>
                <div class="card admin-only">
                    <h4>Yeni Gider</h4>
                    <div class="form-row"><input type="date" id="expenseDateInput" class="form-control"><input type="text" id="expenseNameInput" class="form-control" placeholder="Harcama AdÄ±"><input type="number" id="expenseAmountInput" class="form-control" placeholder="Tutar"></div>
                    <button id="saveExpenseBtn" class="btn btn-primary full-width mt-2">Kaydet</button>
                    <div id="expenseMessage" class="message hidden"></div>
                </div>
                <div class="month-selector"><button id="expensePrevMonthBtn">â—€</button><span id="expenseCurrentMonthDisplay"></span><button id="expenseNextMonthBtn">â–¶</button></div>
                <div class="action-buttons mt-2"><button id="publishButton" class="btn btn-warning admin-only">Giderleri YayÄ±nla</button><button id="downloadMonthlyExpensesBtn" class="btn btn-success">Rapor Ä°ndir (PDF)</button></div>
                <div id="adminExpenseListContainer" class="expense-list mt-3"></div><div class="totals" id="adminExpenseTotals"></div>
            </div>

            <!-- YÃ–NETÄ°CÄ°: DAÄ°RELER -->
            <div id="view-apartments" class="view-section hidden">
                <h2 class="page-title">Daireler</h2>
                <input type="search" id="apartmentSearchInput" class="form-control" placeholder="Daire ara...">
                <div id="apartmentListContainer" class="apartment-list mt-3"></div>
            </div>

            <!-- YÃ–NETÄ°CÄ°: AYARLAR -->
            <div id="view-settings" class="view-section hidden">
                <h2 class="page-title">Ayarlar</h2>
                <div class="card">
                    <h4>Åifre Ä°ÅŸlemleri</h4>
                    <div class="form-row"><div class="col"><label>Daire SeÃ§:</label><select id="sifreDaire" class="form-control"></select></div><div class="col"><label>Yeni Åifre:</label><input type="password" id="yeniSifre" class="form-control"></div></div>
                    <button id="savePasswordBtn" class="btn btn-primary full-width mt-2">Daire Åifresini Kaydet</button>
                    <hr class="section-divider">
                    <div class="form-row"><div class="col"><label>YÃ¶netici Åifresi:</label><input type="password" id="adminYeniSifre" class="form-control"><button id="saveAdminPasswordBtn" class="btn btn-danger full-width mt-2">GÃ¼ncelle</button></div><div class="col"><label>GÃ¶zlemci Åifresi:</label><input type="password" id="viewerAdminYeniSifre" class="form-control"><button id="saveViewerAdminPasswordBtn" class="btn btn-warning full-width mt-2">GÃ¼ncelle</button></div></div>
                    <div id="passwordMessage" class="message hidden"></div>
                </div>
                <div class="card mt-3">
                    <h4>Toplu Profil Ä°ÅŸlemleri</h4>
                    <div class="flex-wrap-gap"><button id="downloadTemplateBtn" class="btn btn-outline">Åablon Ä°ndir</button><input type="file" id="profileTemplateInput" accept=".csv" style="display:none"><button id="uploadTemplateBtn" class="btn btn-outline">YÃ¼kle</button><button id="downloadAllProfilesCsvBtn" class="btn btn-success">Yedek Al</button><button id="deleteAllTransactionsBtn" class="btn btn-danger" style="margin-left:auto">SÄ±fÄ±rla</button></div>
                    <div id="settingsMessage" class="message hidden"></div>
                </div>
            </div>

            <!-- KULLANICI EKRANLARI -->
            <div id="user-view-debt" class="view-section hidden">
                <h2 class="page-title">Hesap Durumu</h2>
                <div id="userBalanceCard" class="balance-summary-card collapsible-trigger">
                    <div class="balance-content"><span class="summary-title">GÃ¼ncel Bakiye</span><span id="userUnpaidTotal" class="summary-amount">...</span></div><span class="toggle-icon">â–¼</span>
                </div>
                <div id="userBalanceDetails" class="card mt-3 collapsed-content">
                    <div class="table-responsive"><table class="transaction-table mobile-responsive-table"><thead><tr><th>Tarih</th><th>AÃ§Ä±klama</th><th>Tutar</th><th>Bakiye</th></tr></thead><tbody id="userTransactionList"></tbody></table></div>
                    <div class="totals" id="userDebtTotals"></div>
                </div>
                <div class="bank-info mt-3"><p><strong>YÄ±ldÄ±z KonaklarÄ± Site YÃ¶netimi</strong></p><p><strong>IBAN:</strong> TR510001000110981102095001</p></div>
            </div>
            <div id="user-view-profile" class="view-section hidden"><h2 class="page-title">Profilim</h2><div class="card"><div id="profileDisplayView"></div><button id="changePasswordBtn" class="btn btn-secondary full-width mt-3">Åifre DeÄŸiÅŸtir</button><div id="profileMessage" class="message hidden"></div></div></div>
            <div id="user-view-expenses" class="view-section hidden"><h2 class="page-title">Giderler</h2><div id="expenseNotPublishedMessage" class="message hidden">YayÄ±nlanmÄ±ÅŸ gider yok.</div><div id="expenseTableContainer"><div id="userExpenseList" class="expense-list"></div><div class="totals" id="userExpenseTotals"></div></div></div>

        </main>
    </div>

    <!-- MODALS -->
    <div id="termsModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h4>KullanÄ±cÄ± AydÄ±nlatma Metni ve Gizlilik SÃ¶zleÅŸmesi</h4>
            <div class="terms-box" style="height: 300px; overflow-y: scroll; border:1px solid #eee; padding:10px; font-size:0.9em; line-height:1.5;">
                <p><strong>1. AmaÃ§ ve Kapsam</strong><br>Bu metin, 6698 sayÄ±lÄ± KiÅŸisel Verilerin KorunmasÄ± Kanunu (â€œKVKKâ€) kapsamÄ±nda, YÄ±ldÄ±z KonaklarÄ± Site YÃ¶netimi tarafÄ±ndan iÅŸlenen kiÅŸisel verileriniz hakkÄ±nda sizi aydÄ±nlatmak amacÄ±yla hazÄ±rlanmÄ±ÅŸtÄ±r.</p>
                <p><strong>2. Ä°ÅŸlenen KiÅŸisel Veriler</strong><br>Site yÃ¶netimi faaliyetleri kapsamÄ±nda; Ad-Soyad, Telefon NumarasÄ±, E-posta Adresi, Daire NumarasÄ± ve AraÃ§ Plaka bilgileriniz iÅŸlenmektedir.</p>
                <p><strong>3. Veri Ä°ÅŸleme AmaÃ§larÄ±</strong><br>KiÅŸisel verileriniz; aidat takibi, site iÃ§i iletiÅŸimin saÄŸlanmasÄ±, gÃ¼venlik ve yasal yÃ¼kÃ¼mlÃ¼lÃ¼klerin yerine getirilmesi amacÄ±yla iÅŸlenmektedir.</p>
                <p><strong>4. Veri AktarÄ±mÄ±</strong><br>KiÅŸisel verileriniz, yasal zorunluluklar haricinde Ã¼Ã§Ã¼ncÃ¼ kiÅŸilerle paylaÅŸÄ±lmamaktadÄ±r. Ancak hukuki uyuÅŸmazlÄ±k durumunda yetkili mercilere aktarÄ±labilir.</p>
                <p><strong>5. HaklarÄ±nÄ±z</strong><br>KVKKâ€™nÄ±n 11. maddesi uyarÄ±nca; verilerinizin iÅŸlenip iÅŸlenmediÄŸini Ã¶ÄŸrenme, dÃ¼zeltme ve silme talep etme hakkÄ±na sahipsiniz.</p>
                <br>
                <p><strong>GÄ°ZLÄ°LÄ°K VE KULLANIM SÃ–ZLEÅMESÄ°</strong><br>Bu sistemi kullanarak, site yÃ¶netimi tarafÄ±ndan belirlenen kurallara uymayÄ± ve kiÅŸisel verilerinizin yukarÄ±da belirtilen amaÃ§larla iÅŸlenmesini kabul etmiÅŸ olursunuz.</p>
            </div>
        </div>
    </div>
    
    <div id="registrationModal" class="modal" style="z-index: 2000;">
        <div class="modal-content">
            <h4 style="color:var(--primary); margin-top:0; margin-bottom:15px;">Site KaydÄ± OluÅŸtur</h4>
            <div style="background-color: #e3f2fd; padding: 15px; border-radius: 6px; margin-bottom: 20px; border-left: 4px solid #014f86;">
                <p id="welcomeMessageText" style="margin:0; color:#014f86; font-size:0.95em; line-height:1.5;"></p>
            </div>
            <input type="tel" id="regTelefon" class="form-control mb-2" placeholder="Telefon NumaranÄ±z">
            <input type="email" id="regMail" class="form-control mb-2" placeholder="E-posta Adresiniz">
            <input type="text" id="regAdres" class="form-control mb-2" placeholder="Ä°kametgah Adresiniz">
            <button id="saveRegistrationBtn" class="btn btn-primary full-width mt-3">Kaydet</button>
            <div id="registrationMessage" class="message hidden"></div>
        </div>
    </div>
    
    <div id="apartmentDetailModal" class="modal"><div class="modal-content"><span class="modal-close">&times;</span><h3 id="apartmentDetailTitle">Detay</h3><div id="apartmentDetailContent" style="margin-bottom:20px;"></div><div class="modal-actions" style="display:flex;gap:10px;justify-content:space-between;"><button id="editApartmentDetailBtn" class="btn btn-warning">DÃ¼zenle</button><button id="downloadApartmentStatementBtn" class="btn btn-secondary">Ekstre</button><button id="deleteApartmentBtn" class="btn btn-danger">Sil</button></div></div></div>

    <script type="module" src="app.js"></script>
</body>
</html>
